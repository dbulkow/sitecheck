<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Site Check</title>
    <script type="text/javascript" src="//code.jquery.com/jquery-2.2.0.min.js"></script>
    <style>
.offline {
    color: red
}
.online {
    color: green
}
.unknown {
    color: white
}
    </style>
  </head>
  <body>
    <table>
      {{range .}}
      <tr>
	<td>{{.Name}}</td>
	<td>{{if eq .Type "website"}}<a href="{{.URL}}">{{.URL}}</a>{{else}}{{.URL}}{{end}}</td>
	<td id="{{.Hash}}" class="{{.Status}}">{{.Status}}</td>
      </tr>
      {{end}}
    </table>

    <script type="text/javascript">
function pull() {
    $.ajax({
	type: "GET",
	url: "/status",
	dataType: "json",
	cache: false,
	success: updater,
    });
}

function updater(response, success) {
    var items = [];
    var again = 0;

    for (var x = 0; x < response.length; x++) {
	resp = response[x]

	console.log("setting "+resp.hash+" to "+resp.status);

	$("#"+resp.hash).text(resp.status)
	$("#"+resp.hash).attr('class', resp.status)

	if (response[x].status == "unknown") {
	    again = 1;
	}
    }

    if (again) {
	window.setTimeout(pull, 1000);
    }
}

window.setTimeout(pull, 1000);
    </script>
  </body>
</html>
